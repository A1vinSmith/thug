

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration &mdash; Thug 2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="static/documentation_options.js"></script>
        <script src="static/jquery.js"></script>
        <script src="static/underscore.js"></script>
        <script src="static/doctools.js"></script>
        <script src="static/language_data.js"></script>
    
    <script type="text/javascript" src="static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Usage" href="usage.html" />
    <link rel="prev" title="Docker" href="docker.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Thug
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build and Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#honeyagent-optional">HoneyAgent (optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#virustotal-optional">VirusTotal (optional)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Thug API</a></li>
<li class="toctree-l1"><a class="reference internal" href="jshooks.html">JS Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugin Framework</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Thug</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="sources/configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration">
<span id="id1"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="honeyagent-optional">
<h2>HoneyAgent (optional)<a class="headerlink" href="#honeyagent-optional" title="Permalink to this headline">¶</a></h2>
<p>HoneyAgent is a Java agent library that creates a sandbox for Java
applications and applets. It uses the JVMTI as well as the JNI to
intercept class loading and function calls.</p>
<p>During runtime HoneyAgent traces function calls performed by the
analyzed application. It shows which class calls which function
with which parameters. Reflected function calls are translated to
the original function names for simpler reading.</p>
<p>HoneyAgent provides simple means to hook individual Java functions
e.g. to provide fake values to the analyzed application. These hooks
are caller sensitive, so that default JRE classes can still function
properly. The process of class loading is also intercepted to identify
invalid bytecode and optionally make changes to get the class running
within the observed environment.</p>
<p>To sandbox the application, file accesses are redirected to a jailed
environment. Furthermore, Java properties as well as environment
variables are faked due to according Java function hooks.</p>
<p>HoneyAgent source code can be downloaded at</p>
<p><a class="reference external" href="https://bitbucket.org/fkie_cd_dare/honeyagent">https://bitbucket.org/fkie_cd_dare/honeyagent</a></p>
<p>It is HIGHLY suggested to run HoneyAgent in a dedicated VM because
there exists the possibility a sample could circumvent the sandbox
and compromise the machine. In such case please consider that a OVA
is available (and already configured) at</p>
<p><a class="reference external" href="https://www.dropbox.com/s/qieyfe97qvh7pjp/Honeyagent-r2.ova">https://www.dropbox.com/s/qieyfe97qvh7pjp/Honeyagent-r2.ova</a></p>
<p>Login   : thug
Password: thug</p>
<p>In order to configure Thug to submit applets for analysis to HoneyAgent
edit the configuration file <em>/etc/thug/thug.conf</em> as shown later.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>honeyagent<span class="o">]</span>
scanurl:                        http://192.168.56.101:8000
</pre></div>
</div>
<p>Please note that if the file <em>thug.conf</em> does not exists Thug will
assume you do not want to submit applets to HoneyAgent. Alternatively
you can disable the HoneyAgent support through command line even if the
the <em>thug.conf</em> file exists (option -N or –no-honeyagent).</p>
<p>This configuration instructs Thug to send the applet to analyze to the
server whose IP address is 192.168.56.101 (please verify your network
configuration and modify it accordingly) listening on port 8000/tcp.</p>
<p>In order to enable this service run this commands on the HoneyAgent
machine</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>thug@honeyagent:~$ <span class="nb">cd</span> honeyagent/HoneyDaemon/
thug@honeyagent:~/honeyagent/HoneyDaemon$ python daemon.py run.ini
HoneyAgent daemon running on port <span class="m">8000</span>
</pre></div>
</div>
<p>After the service is enabled and properly configured you should be
able to automatically analyze applets like shown later.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>buffer@rigel ~ $ thug http://192.168.0.100:8080/1
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:53<span class="o">]</span> <span class="o">[</span>window open redirection<span class="o">]</span> about:blank -&gt; http://192.168.0.100:8080/1
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:53<span class="o">]</span> <span class="o">[</span>HTTP Redirection <span class="o">(</span>Status: <span class="m">302</span><span class="o">)]</span> Content-Location: http://192.168.0.100:8080/1 --&gt; Location: http://192.168.0.100:8080/1/
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:53<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://192.168.0.100:8080/1/ <span class="o">(</span>Status: <span class="m">200</span>, Referrer: None<span class="o">)</span>
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:53<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://192.168.0.100:8080/1/ <span class="o">(</span>Content-type: text/html, MD5: 514658fc397a7f227bd0d3e11b22c428<span class="o">)</span>
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:53<span class="o">]</span> &lt;applet <span class="nv">archive</span><span class="o">=</span><span class="s2">&quot;qqNqSoke.jar&quot;</span> <span class="nv">code</span><span class="o">=</span><span class="s2">&quot;BTrJ.class&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/applet&gt;
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:53<span class="o">]</span> <span class="o">[</span>Navigator URL Translation<span class="o">]</span> qqNqSoke.jar --&gt; http://192.168.0.100:8080/1/qqNqSoke.jar
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:53<span class="o">]</span> <span class="o">[</span>applet redirection<span class="o">]</span> http://192.168.0.100:8080/1/ -&gt; http://192.168.0.100:8080/1/qqNqSoke.jar
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:53<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://192.168.0.100:8080/1/qqNqSoke.jar <span class="o">(</span>Status: <span class="m">200</span>, Referrer: http://192.168.0.100:8080/1/<span class="o">)</span>
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:53<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://192.168.0.100:8080/1/qqNqSoke.jar <span class="o">(</span>Content-type: application/octet-stream, MD5: 1b3354f594522ff32791c278f50f2efa<span class="o">)</span>
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:56<span class="o">]</span> <span class="o">[</span>HoneyAgent<span class="o">][</span>1b3354f594522ff32791c278f50f2efa<span class="o">]</span> Sample submitted
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:57<span class="o">]</span> <span class="o">[</span>HoneyAgent<span class="o">][</span>1b3354f594522ff32791c278f50f2efa<span class="o">]</span> Dropped sample uAzpYJRZ.exe
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:57<span class="o">]</span> <span class="o">[</span>HoneyAgent<span class="o">][</span>1b3354f594522ff32791c278f50f2efa<span class="o">]</span> Dropped sample IixfXAb.class
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:57<span class="o">]</span> <span class="o">[</span>HoneyAgent<span class="o">][</span>1b3354f594522ff32791c278f50f2efa<span class="o">]</span> Dropped sample ArIBNUkvAi.dat
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:57<span class="o">]</span> <span class="o">[</span>HoneyAgent<span class="o">][</span>1b3354f594522ff32791c278f50f2efa<span class="o">]</span> Yara heuristics rule CreatesNewProcess match
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:57<span class="o">]</span> <span class="o">[</span>HoneyAgent<span class="o">][</span>1b3354f594522ff32791c278f50f2efa<span class="o">]</span> Yara heuristics rule WritesMZFile match
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:57<span class="o">]</span> <span class="o">[</span>HoneyAgent<span class="o">][</span>1b3354f594522ff32791c278f50f2efa<span class="o">]</span> Yara heuristics rule WritesExeFile match
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:57<span class="o">]</span> <span class="o">[</span>HoneyAgent<span class="o">][</span>1b3354f594522ff32791c278f50f2efa<span class="o">]</span> Yara heuristics rule LocalFileAccess match
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:57<span class="o">]</span> <span class="o">[</span>HoneyAgent<span class="o">][</span>1b3354f594522ff32791c278f50f2efa<span class="o">]</span> Yara heuristics rule RestrictedPropertyAccess match
<span class="o">[</span><span class="m">2014</span>-07-07 <span class="m">23</span>:50:57<span class="o">]</span> Saving log analysis at /tmp/thug/logs/97ae3a4c476f3efab64b70b26b0f7b57/20140707235053

buffer@rigel ~ $ <span class="nb">cd</span> /tmp/thug/logs/97ae3a4c476f3efab64b70b26b0f7b57/20140707235053/analysis/honeyagent/
buffer@rigel /tmp/thug/logs/97ae3a4c476f3efab64b70b26b0f7b57/20140707235053/analysis/honeyagent $ ls -lhR
.:
total 668K
-rw-r--r-- <span class="m">1</span> buffer buffer 665K Jul  <span class="m">7</span> <span class="m">23</span>:50 1b3354f594522ff32791c278f50f2efa.json
drwxr-xr-x <span class="m">2</span> buffer buffer   <span class="m">66</span> Jul  <span class="m">7</span> <span class="m">23</span>:50 dropped

./dropped:
total 92K
-rw-r--r-- <span class="m">1</span> buffer buffer  <span class="m">110</span> Jul  <span class="m">7</span> <span class="m">23</span>:50 ArIBNUkvAi.dat
-rw-r--r-- <span class="m">1</span> buffer buffer <span class="m">9</span>.2K Jul  <span class="m">7</span> <span class="m">23</span>:50 IixfXAb.class
-rw-r--r-- <span class="m">1</span> buffer buffer  73K Jul  <span class="m">7</span> <span class="m">23</span>:50 uAzpYJRZ.exe

buffer@rigel /tmp/thug/logs/97ae3a4c476f3efab64b70b26b0f7b57/20140707235053/analysis/honeyagent $ <span class="nb">cd</span> dropped/
buffer@rigel /tmp/thug/logs/97ae3a4c476f3efab64b70b26b0f7b57/20140707235053/analysis/honeyagent/dropped $ file *
ArIBNUkvAi.dat: ASCII text
IixfXAb.class:  compiled Java class data, version <span class="m">45</span>.3
uAzpYJRZ.exe:   PE32 executable <span class="o">(</span>GUI<span class="o">)</span> Intel <span class="m">80386</span>, <span class="k">for</span> MS Windows
</pre></div>
</div>
</div>
<div class="section" id="virustotal-optional">
<h2>VirusTotal (optional)<a class="headerlink" href="#virustotal-optional" title="Permalink to this headline">¶</a></h2>
<p>VirusTotal is a free service that analyzes suspicious files and URLs and
facilitates the quick detection of viruses, worms, trojans, and all kinds
of malware.</p>
<p>Thug supports VirusTotal and a default API key is now included in the default
configuration file (many thanks to the VirusTotal team). To change the default
VirusTotal key with your own, simply edit <em>/etc/thug/thug.conf</em> as shown
later.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>virustotal<span class="o">]</span>
apikey:                         &lt;enter your API key here&gt;
scanurl:                        https://www.virustotal.com/vtapi/v2/file/scan
reporturl:                      https://www.virustotal.com/vtapi/v2/file/report
</pre></div>
</div>
<p>You may also pass a runtime value for the API key parameter by using the –vt-apikey or -b parameter:
this may come handy when using a dockerized Thug instance where editing the configuration file prior
to each run may not be that simple.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usage.html" class="btn btn-neutral float-right" title="Usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="docker.html" class="btn btn-neutral float-left" title="Docker" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2021, Angelo Dell&#39;Aera

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>