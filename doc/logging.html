
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Logging &#8212; Thug 0.9.19 documentation</title>
    <link rel="stylesheet" href="static/classic.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9.19',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Plugin Framework" href="plugins.html" />
    <link rel="prev" title="JS Hooks" href="jshooks.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plugins.html" title="Plugin Framework"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="jshooks.html" title="JS Hooks"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Thug 0.9.19 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="logging">
<span id="id1"></span><h1>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<p>Currently different logging modes are available in Thug. Some of them can be combined
in order to store the result of the analysis in different formats if needed. By default
Thug attempts storing analysis logs in a MongoDB instance (see later for a detailed
explanation of the MongoDB collection schema).</p>
<p><strong>BEWARE</strong>: if a MongoDB instance is not available and no other logging mode is selected
Thug will not store any analysis log.</p>
<p>The available logging modes are:</p>
<ul class="simple">
<li>MongoDB logging mode (enabled by default)</li>
<li>HPFeeds logging mode (enabled by default)</li>
<li>ElasticSearch</li>
<li>JSON logging mode</li>
<li>MAEC 1.1 logging mode</li>
<li>File logging mode</li>
</ul>
<div class="section" id="logging-configuration">
<h2>Logging configuration<a class="headerlink" href="#logging-configuration" title="Permalink to this headline">¶</a></h2>
<p>The configuration file <em>/etc/thug/logging.conf</em> defines the way Thug uses to log the results
of its analyses. The default logging.conf file is shown below.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">[</span>hpfeeds<span class="o">]</span>
enable:     False
host:       hpfeeds.honeycloud.net
port:       <span class="m">10000</span>
ident:      q6jyo@hp1
secret:     edymvouqpfe1ivud

<span class="o">[</span>mongodb<span class="o">]</span>
enable:     True
host:       localhost
port:       <span class="m">27017</span>

<span class="o">[</span>elasticsearch<span class="o">]</span>
enable:     True
url:        http://192.168.56.101:9200
index:      thug
</pre></div>
</div>
<p>The different sections of the configuration files will be explained later in this
document.</p>
</div>
<div class="section" id="mongodb-logging-mode">
<h2>MongoDB logging mode<a class="headerlink" href="#mongodb-logging-mode" title="Permalink to this headline">¶</a></h2>
<p>By default Thug attempts storing the result of its analyses in a MongoDB instance. Be
aware that if you don’t install MongoDB and pymongo (the Python wrapper) or if the
MongoDB process is not running, Thug will just emit a warning message and then continue
its analysis silently not storing the results. This could be exactly what you want but
please consider that if you do not enable any other logging mode you will end up with
no logs at all so bear it in mind.</p>
<p>The configuration file <em>/etc/thug/logging.conf</em> defines the MongoDB instance configuration
parameters</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">[</span>mongodb<span class="o">]</span>
enable:     True
host:       localhost
port:       <span class="m">27017</span>
</pre></div>
</div>
<p>The parameters should be quite intuitive to understand. By the way if you install
MongoDB on the same host you are supposed to run Thug you should not need changing
anything in the default configuration.</p>
<p>If you want Thug to store its results to a different MongoDB instance than that defined
in your <em>/etc/thug/logging.conf</em> file, you can specify a different address at runtime, for
example by using the <em>–mongodb-address</em> option from the command line. This can be especially
useful when using the dockerized version of Thug, where storing results in Docker itself would
mean to lose them as soon as the Docker instance is shut down.</p>
<div class="section" id="collection-schema">
<h3>Collection schema<a class="headerlink" href="#collection-schema" title="Permalink to this headline">¶</a></h3>
<div class="section" id="urls">
<h4>urls<a class="headerlink" href="#urls" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>urls</em> is used to keep track of the URLs visited during the analysis.
A URL is always associated a single entry in this collection even if it is visited
multiple times (during the same analysis or in different analyses). Associating a
unique ObjectID to a given URL allows to easily spot interesting scenarios like
different redirection chains ending up using the same URLs.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;url&quot;</span> : URL
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="analyses">
<h4>analyses<a class="headerlink" href="#analyses" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>analyses</em> is used to keep track of the Thug analyses. The analysis
options used for the single analysis are stored together with other useful information
like the used Thug version and the analysis datetime. Moreover the URL ObjectID of the
initial URL is stored for convenience.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;url_id&quot;</span>      : Initial URL url_id
    <span class="s2">&quot;timestamp&quot;</span>   : Analysis datetime
    <span class="s2">&quot;thug&quot;</span>        : <span class="o">{</span>
                        <span class="s2">&quot;version&quot;</span>            : Thug version
                        <span class="s2">&quot;personality&quot;</span> : <span class="o">{</span>
                            <span class="s2">&quot;useragent&quot;</span>      : User Agent
                        <span class="o">}</span>,
                        <span class="s2">&quot;plugins&quot;</span> : <span class="o">{</span>
                            <span class="s2">&quot;acropdf&quot;</span>        : Acrobat Reader version <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                            <span class="s2">&quot;javaplugin&quot;</span>     : JavaPlugin version <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                            <span class="s2">&quot;shockwaveflash&quot;</span> : Shockwave Flash version <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                        <span class="o">}</span>,
                        <span class="s2">&quot;options&quot;</span> : <span class="o">{</span>
                            <span class="s2">&quot;local&quot;</span>          : Local analysis
                            <span class="s2">&quot;nofetch&quot;</span>        : Local no-fetch analysis
                            <span class="s2">&quot;proxy&quot;</span>          : Proxy <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                            <span class="s2">&quot;events&quot;</span>         : Additional DOM events to be processed
                            <span class="s2">&quot;delay&quot;</span>          : Maximum setTimeout/setInterval delay value <span class="o">(</span>in milliseconds<span class="o">)</span>
                            <span class="s2">&quot;referer&quot;</span>        : Referer
                            <span class="s2">&quot;timeout&quot;</span>        : Analysis timeout
                            <span class="s2">&quot;threshold&quot;</span>      : Maximum pages to fetch
                            <span class="s2">&quot;extensive&quot;</span>      : Extensive fetch of linked pages
                        <span class="o">}</span>,
                    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="connections">
<h4>connections<a class="headerlink" href="#connections" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>connections</em> is used to keep track of the redirections which could happen
during the single analysis. The field <em>chain_id</em> is a counter which is incremented by one at
every redirection and it’s meant to be used in order to rebuild the redirection chain in the
right order while analyzing data.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>    : Analysis ID
    <span class="s2">&quot;chain_id&quot;</span>       : Chain ID
    <span class="s2">&quot;source_id&quot;</span>      : Source URL url_id
    <span class="s2">&quot;destination_id&quot;</span> : Destination URL url_id
    <span class="s2">&quot;method&quot;</span>         : Method
    <span class="s2">&quot;flags&quot;</span>          : Flags
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="locations">
<h4>locations<a class="headerlink" href="#locations" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>locations</em> is used to keep track of the content stored at each URL visited
during the analysis. The content is stored in a MongoDB GridFS and additional metadata are
saved like MD5 and SHA-256 checksums, content size, content type (as served by the server)
and evaluated content type.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;url_id&quot;</span>        : URL url_id
    <span class="s2">&quot;status&quot;</span>        : HTTP status code
    <span class="s2">&quot;content_id&quot;</span>    : Content ID <span class="o">(</span>content stored in the GridFS fs<span class="o">)</span>
    <span class="s2">&quot;content-type&quot;</span>  : Content Type
    <span class="s2">&quot;md5&quot;</span>           : MD5 checksum
    <span class="s2">&quot;sha256&quot;</span>        : SHA-256 checksum
    <span class="s2">&quot;flags&quot;</span>         : Flags
    <span class="s2">&quot;size&quot;</span>          : Data size
    <span class="s2">&quot;mime-type&quot;</span>     : Evaluated content <span class="nb">type</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="samples">
<h4>samples<a class="headerlink" href="#samples" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>samples</em> is used to keep track of the downloaded samples (currently supported
types: PE, PDF, JAR and SWF). The sample itself is stored in a MongoDB GridFS and additional
metadata are saved like MD5, SHA-1 and SHA-256 checksums, sample type and imphash (if the sample
type is PE).</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;url_id&quot;</span>        : URL url_id
    <span class="s2">&quot;sample_id&quot;</span>     : Sample ID <span class="o">(</span>sample stored in the GridFS fs<span class="o">)</span>
    <span class="s2">&quot;type&quot;</span>          : Sample <span class="nb">type</span>
    <span class="s2">&quot;md5&quot;</span>           : MD5 checksum
    <span class="s2">&quot;sha1&quot;</span>          : SHA-1 checksum
    <span class="s2">&quot;sha256&quot;</span>        : SHA-256 checksum
    <span class="s2">&quot;imphash&quot;</span>       : Imphash <span class="o">(</span><span class="k">if</span> <span class="nb">type</span> is PE<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="exploits">
<h4>exploits<a class="headerlink" href="#exploits" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>eploits</em> is used to keep track of the exploits which were successfully
identified during the analysis while visiting the URL referenced by <em>url_id</em>.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s1">&#39;analysis_id&#39;</span> : Analysis ID
    <span class="s1">&#39;url_id&#39;</span>      : URL url_id
    <span class="s1">&#39;module&#39;</span>      : Module/ActiveX Control, etc. that gets exploited
    <span class="s1">&#39;description&#39;</span> : Description of the exploit
    <span class="s1">&#39;cve&#39;</span>         : CVE number <span class="o">(</span><span class="k">if</span> available<span class="o">)</span>
    <span class="s1">&#39;data&#39;</span>        : Additional information
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="classifiers">
<h4>classifiers<a class="headerlink" href="#classifiers" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>classifiers</em> is used to keep track of the Thug classifiers matches that
fire during the analysis while visiting the URL referenced by <em>url_id</em>.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s1">&#39;analysis_id&#39;</span> : Analysis ID
    <span class="s1">&#39;url_id&#39;</span>      : URL url_id
    <span class="s1">&#39;classifier&#39;</span>  : Classifier name <span class="o">(</span>possible values: html, js, url, sample<span class="o">)</span>
    <span class="s1">&#39;rule&#39;</span>        : Rule name
    <span class="s1">&#39;tags&#39;</span>        : Rule tags
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="codes">
<h4>codes<a class="headerlink" href="#codes" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>codes</em> is used to keep track of the (dynamic language) snippets of code
identified during the analysis.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s1">&#39;analysis_id&#39;</span>  : Analysis ID
    <span class="s1">&#39;snippet&#39;</span>      : Code snippet
    <span class="s1">&#39;language&#39;</span>     : Code language
    <span class="s1">&#39;relationship&#39;</span> : Relationship with the page that references the code
    <span class="s1">&#39;tag&#39;</span>          : Snippet tag <span class="o">(</span>cross-references<span class="o">)</span>
    <span class="s1">&#39;method&#39;</span>       : Analysis method
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="behaviors">
<h4>behaviors<a class="headerlink" href="#behaviors" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>behaviors</em> is used to keep track of the suspicious and/or malicious
behaviors observed during the analysis.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s1">&#39;analysis_id&#39;</span> : Analysis ID
    <span class="s1">&#39;description&#39;</span> : Observed behavior description
    <span class="s1">&#39;cve&#39;</span>         : CVE number <span class="o">(</span><span class="k">if</span> available<span class="o">)</span>
    <span class="s1">&#39;snippet&#39;</span>     : Code snippet tag <span class="o">(</span><span class="k">if</span> available<span class="o">)</span>
    <span class="s1">&#39;method&#39;</span>      : Analysis method
    <span class="s1">&#39;timestamp&#39;</span>   : Timestamp
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="certificates">
<h4>certificates<a class="headerlink" href="#certificates" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>certificates</em> is used to store the SSL certificates collected from
servers during the analysis.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;url_id&quot;</span>        : URL url_id
    <span class="s2">&quot;certificate&quot;</span>   : SSL certificate
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="graphs">
<h4>graphs<a class="headerlink" href="#graphs" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>graphs</em> is used to store the analysis JSON exploit graph.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;graph&quot;</span>         : JSON exploit graph
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="virustotal">
<h4>virustotal<a class="headerlink" href="#virustotal" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>virustotal</em> is used to store the VirusTotal sample analysis reports.
The Sample ObjectID references the <em>samples</em> collection.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;sample_id&quot;</span>     : Sample ID
    <span class="s2">&quot;report&quot;</span>        : VirusTotal report <span class="o">(</span>JSON<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="honeyagent">
<h4>honeyagent<a class="headerlink" href="#honeyagent" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>honeyagent</em> is used to store the HoneyAgent Java sandbox sample analysis
reports. The Sample ObjectID references the <em>samples</em> collection.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;sample_id&quot;</span>     : Sample ID
    <span class="s2">&quot;report&quot;</span>        : HoneyAgent report <span class="o">(</span>JSON<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="maec11">
<h4>maec11<a class="headerlink" href="#maec11" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>maec11</em> is used to store the Thug analysis reports in MITRE MAEC 1.1
format. MAEC 1.1 logging mode should be enabled in order to have Thug saving data in
this collection</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
        <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
        <span class="s2">&quot;report&quot;</span>        : Analysis report <span class="o">(</span>MITRE MAEC <span class="m">1</span>.1 format - XML<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="json">
<h4>json<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>json</em> is used to store the Thug analysis reports in JSON format.
JSON logging mode should be enabled in order to have Thug saving data in
this collection</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
        <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
        <span class="s2">&quot;report&quot;</span>        : Analysis report <span class="o">(</span>JSON<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="hpfeeds-logging-mode">
<h2>HPFeeds logging mode<a class="headerlink" href="#hpfeeds-logging-mode" title="Permalink to this headline">¶</a></h2>
<p>HPFeeds is the Honeynet Project central logging feature.</p>
<p>HPFeeds is a lightweight authenticated publish-subscribe protocol that supports arbitrary
binary payloads. HPFeeds was designed as a simple wire-format so that everyone is able to
subscribe to the feeds with his favorite language in almost no time.</p>
<p>Different feeds are separated by channels and support arbitrary binary payloads. This means
that the channel users have to decide about the structure of data. This could for example
be done by choosing a serialization format.</p>
<p>Access to channels is given to so-called Authkeys which essentially are pairs of an identifier
and a secret. The secret is sent to the server by hashing it together with a per-connection
nonce. This way no eavesdroppers can obtain valid credentials. Optionally the protocol can
be run on top of SSL/TLS, of course.</p>
<p>HPFeeds logging mode is disabled by default and its configuration is saved in the <em>/etc/thug/logging.conf</em>
file</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">[</span>hpfeeds<span class="o">]</span>
enable:     False
host:       hpfeeds.honeycloud.net
port:       <span class="m">10000</span>
ident:      q6jyo@hp1
secret:     edymvouqpfe1ivud
</pre></div>
</div>
<p>If you want to report your events and samples, you can turn on HPFeeds by modifying
the <em>enable</em> parameter to <em>True</em>. Do not change the other configuration parameters unless
you know exactly what you are doing.</p>
<p>Currently Thug shares data in two channels:</p>
<ul class="simple">
<li>thug.events channel (URL analysis results published in MAEC 1.1 format)</li>
<li>thug.files channel (downloaded samples)</li>
</ul>
<p>If you are interested in the data collected by Thug instances, please contact me.</p>
</div>
<div class="section" id="elasticsearch-logging-module">
<h2>ElasticSearch logging module<a class="headerlink" href="#elasticsearch-logging-module" title="Permalink to this headline">¶</a></h2>
<p>The ElasticSearch logging mode allows to store both the analysis results and each resource
downloaded during the analysis in an ElasticSearch instance. Deploying and configuring the
instance is totally up to you and no images are provided for that.</p>
<p>ElasticSearch logging mode is not enabled by default and you need to enable the option -G
(–elasticsearch-logging). The ElasticSearch configuration is saved in in the <em>/etc/thug/logging.conf</em>
file. Be sure of defining the right URL for connecting to your instance. You may want to
change the index name where data will be stored but this is not really necessary in the most
common situations.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">[</span>elasticsearch<span class="o">]</span>
enable:     True
url:        http://192.168.56.101:9200
index:      thug
</pre></div>
</div>
</div>
<div class="section" id="json-logging-mode">
<h2>JSON logging mode<a class="headerlink" href="#json-logging-mode" title="Permalink to this headline">¶</a></h2>
<p>The JSON logging mode allows to store both the analysis results and each resource
downloaded during the analysis in JSON format. The JSON logging mode was enabled by default
before Thug 0.5.6 together with the File logging mode. If you are using Thug 0.5.7 (or later)
you have to explicitely enable it through the option <em>-Z</em> (or <em>–json-logging</em>). Please consider
that the JSON log is stored in the MongoDB instance (if available). See the <em>MongoDB logging
mode</em> for details. If the File logging format is enabled too, the JSON log will be stored
in a JSON file in the log directory too. The JSON format is shown below.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;url&quot;</span>         : Initial URL
    <span class="s2">&quot;timestamp&quot;</span>   : Analysis datetime
    <span class="s2">&quot;logtype&quot;</span>     : <span class="s2">&quot;json-log&quot;</span>,
    <span class="s2">&quot;thug&quot;</span>        : <span class="o">{</span>
                        <span class="s2">&quot;version&quot;</span>            : Thug version
                        <span class="s2">&quot;personality&quot;</span> : <span class="o">{</span>
                                <span class="s2">&quot;useragent&quot;</span>      : User Agent
                        <span class="o">}</span>,
                        <span class="s2">&quot;plugins&quot;</span> : <span class="o">{</span>
                                <span class="s2">&quot;acropdf&quot;</span>        : Acrobat Reader version <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                                <span class="s2">&quot;javaplugin&quot;</span>     : JavaPlugin version <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>,
                                <span class="s2">&quot;shockwaveflash&quot;</span> : Shockwave Flash version <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                        <span class="o">}</span>,
                        <span class="s2">&quot;options&quot;</span> : <span class="o">{</span>
                                <span class="s2">&quot;local&quot;</span>          : Local analysis
                                <span class="s2">&quot;nofetch&quot;</span>        : Local no-fetch analysis
                                <span class="s2">&quot;proxy&quot;</span>          : Proxy <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                                <span class="s2">&quot;events&quot;</span>         : Additional DOM events to be processed
                                <span class="s2">&quot;delay&quot;</span>          : Maximum setTimeout/setInterval delay value <span class="o">(</span>in milliseconds<span class="o">)</span>
                                <span class="s2">&quot;referer&quot;</span>        : Referer
                                <span class="s2">&quot;timeout&quot;</span>        : Analysis timeout
                                <span class="s2">&quot;threshold&quot;</span>      : Maximum pages to fetch
                                <span class="s2">&quot;extensive&quot;</span>      : Extensive fetch of linked pages
                        <span class="o">}</span>,
    <span class="s2">&quot;behavior&quot;</span>    : <span class="o">[]</span>,
    <span class="s2">&quot;code&quot;</span>        : <span class="o">[]</span>,
    <span class="s2">&quot;files&quot;</span>       : <span class="o">[]</span>,
    <span class="s2">&quot;connections&quot;</span> : <span class="o">[]</span>,
    <span class="s2">&quot;locations&quot;</span>   : <span class="o">[]</span>,
    <span class="s2">&quot;exploits&quot;</span>    : <span class="o">[]</span>,
    <span class="s2">&quot;classifiers&quot;</span> : <span class="o">[]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Following the format and additional details about the lists containing the analysis results
and the resources downloaded during the analysis.</p>
<div class="section" id="id2">
<h3>behaviors<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s1">&#39;description&#39;</span> : Observed behavior description
    <span class="s1">&#39;cve&#39;</span>         : CVE number <span class="o">(</span><span class="k">if</span> available<span class="o">)</span>
    <span class="s1">&#39;snippet&#39;</span>     : Code snippet tag <span class="o">(</span><span class="k">if</span> available<span class="o">)</span>
    <span class="s1">&#39;method&#39;</span>      : Analysis method
    <span class="s1">&#39;timestamp&#39;</span>   : Timestamp
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>codes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s1">&#39;snippet&#39;</span>      : Code snippet
    <span class="s1">&#39;language&#39;</span>     : Code language
    <span class="s1">&#39;relationship&#39;</span> : Relationship with the page that references the code
    <span class="s1">&#39;tag&#39;</span>          : Snippet tag <span class="o">(</span>cross-references<span class="o">)</span>
    <span class="s1">&#39;method&#39;</span>       : Analysis method
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="files">
<h3>files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h3>
<p>Each content downloaded during the analysis is saved in an entry in the <em>files</em>
list.</p>
</div>
<div class="section" id="id4">
<h3>connections<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;source&quot;</span>         : Source URL
    <span class="s2">&quot;destination&quot;</span>    : Destination URL
    <span class="s2">&quot;method&quot;</span>         : Method
    <span class="s2">&quot;flags&quot;</span>          : Flags
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>locations<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;url&quot;</span>           : URL url
    <span class="s2">&quot;content&quot;</span>       : Content
    <span class="s2">&quot;status&quot;</span>        : HTTP status code
    <span class="s2">&quot;content-type&quot;</span>  : Content Type
    <span class="s2">&quot;md5&quot;</span>           : MD5 checksum
    <span class="s2">&quot;sha256&quot;</span>        : SHA-256 checksum
    <span class="s2">&quot;flags&quot;</span>         : Flags
    <span class="s2">&quot;size&quot;</span>          : Data size
    <span class="s2">&quot;mime-type&quot;</span>     : Evaluated content <span class="nb">type</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>exploits<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s1">&#39;url&#39;</span>         : URL
    <span class="s1">&#39;module&#39;</span>      : Module/ActiveX Control, etc. that gets exploited
    <span class="s1">&#39;description&#39;</span> : Description of the exploit
    <span class="s1">&#39;cve&#39;</span>         : CVE number <span class="o">(</span><span class="k">if</span> available<span class="o">)</span>
    <span class="s1">&#39;data&#39;</span>        : Additional information
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>classifiers<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;classifier&quot;</span>  : Classifier <span class="o">(</span>possible values: html, js, url, sample<span class="o">)</span>
    <span class="s1">&#39;url&#39;</span>         : URL
    <span class="s1">&#39;rule&#39;</span>        : Rule name
    <span class="s1">&#39;tags&#39;</span>        : Rule tags
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="maec-1-1-logging-mode">
<h2>MAEC 1.1 logging mode<a class="headerlink" href="#maec-1-1-logging-mode" title="Permalink to this headline">¶</a></h2>
<p>Malware Attribute Enumeration and Characterization (MAEC) is a structured language for
encoding and communicating high fidelity information about any type of malware based upon
attributes such as behaviors, artifacts, and attack patterns. As a language, MAEC offers
a grammar and vocabulary that provide a standard means of communicating information about
malware attributes. MAEC is designed and maintaned by MITRE.</p>
<p>Thug currently supports MAEC version 1.1 and you should enable the <em>-M</em> (or <em>–maec11-logging</em>)
option in order to locally store the analysis results in such format.</p>
<p>If the MAEC 1.1 logging mode is enabled, Thug will attempt to store analysis results in a
MongoDB instance, if available.</p>
<p>If the MAEC 1.1 logging mode and the File logging mode are enabled, Thug will attempt to
store analysis results in a MongoDB instance, if available, and in a XML file in the log
directory.</p>
<p>Please note that not enabling MAEC 1.1 logging mode does not affect HPFeeds logging mode
proper operations so even if this mode is not enabled analysis results will be published in
MAEC 1.1 format on the <em>thug.events</em> channel.</p>
<p>Further documentation about the MAEC 1.1 language can be found at <a class="reference external" href="http://maec.mitre.org/language/version1.1/">http://maec.mitre.org/language/version1.1/</a></p>
</div>
<div class="section" id="file-logging-mode">
<h2>File logging mode<a class="headerlink" href="#file-logging-mode" title="Permalink to this headline">¶</a></h2>
<p>The File logging mode allows to store both the analysis results and each resource
downloaded during the analysis in flat files. The File logging mode was enabled by default
before Thug 0.5.6. If you are using Thug 0.5.7 (or later) you have to explicitely enable
it through the option <em>-F</em> (or <em>–file-logging</em>). Please consider that all the information
stored in flat files are stored in the MongoDB instance (if available). This option could
be convenient in some situations but if you plan to analyze a huge number of URLs per day
probably thinking about storing results and resources in a database is better than spread
such data on your hard drive.</p>
<p>If you enable the File logging mode the directory which contains the logs for the session
will appear as shown below</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~/thug/src $ <span class="nb">cd</span> ../logs/baa880d8d79c3488f2c0557be24cca6b/20120702191511
~/thug/logs/baa880d8d79c3488f2c0557be24cca6b/20120702191511 $ ls -lhR
.:
total 232K
-rw-r--r-- <span class="m">1</span> buffer buffer <span class="m">1008</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 502da89357ca5d7c85dc7a67f8977b21
-rw-r--r-- <span class="m">1</span> buffer buffer  81K Jul  <span class="m">2</span> <span class="m">19</span>:15 analysis.xml
drwxr-xr-x <span class="m">6</span> buffer buffer  <span class="m">176</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 application
-rwxr-xr-x <span class="m">1</span> buffer buffer  89K Jul  <span class="m">2</span> <span class="m">19</span>:15 d328b5a123bce1c0d20d763ad745303a
-rw-r--r-- <span class="m">1</span> buffer buffer  51K Jul  <span class="m">2</span> <span class="m">19</span>:15 Ryp.jar
drwxr-xr-x <span class="m">3</span> buffer buffer   <span class="m">72</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 text

./application:
total <span class="m">0</span>
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">96</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 java-archive
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">96</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 pdf
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">96</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 x-msdownload
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">96</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 x-shockwave-flash

./application/java-archive:
total 52K
-rw-r--r-- <span class="m">1</span> buffer buffer 51K Jul  <span class="m">2</span> <span class="m">19</span>:15 e3639fde6ddf7fd0182fff9757143ff2

./application/pdf:
total 16K
-rw-r--r-- <span class="m">1</span> buffer buffer 15K Jul  <span class="m">2</span> <span class="m">19</span>:15 3660fe0e4acd23ac13f3d043eebd2bbc

./application/x-msdownload:
total 92K
-rw-r--r-- <span class="m">1</span> buffer buffer 89K Jul  <span class="m">2</span> <span class="m">19</span>:15 d328b5a123bce1c0d20d763ad745303a

./application/x-shockwave-flash:
total <span class="m">4</span>.0K
-rw-r--r-- <span class="m">1</span> buffer buffer <span class="m">1008</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 502da89357ca5d7c85dc7a67f8977b21

./text:
total <span class="m">0</span>
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">144</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 html

./text/html:
total 72K
-rw-r--r-- <span class="m">1</span> buffer buffer 68K Jul  <span class="m">2</span> <span class="m">19</span>:15 95ee609e6e3b69c2d9e68f34ff4a4335
-rw-r--r-- <span class="m">1</span> buffer buffer <span class="m">878</span> Jul  <span class="m">2</span> <span class="m">19</span>:15 d26b9b1a1f667004945d1d000cf4f19e
</pre></div>
</div>
<p>In this example the MAEC 1.1 logging mode is enabled and the file <em>analysis.xml</em> contains the
URL analysis results saved in MAEC 1.1 format. Please note that all the resources downloaded
during the URL analysis are saved in the log directory based on their Content-Type for
convenience. Moreover if MongoDB is installed the information you can see in this directory
are saved in the database instance as well.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="jshooks.html"
                        title="previous chapter">JS Hooks</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plugins.html"
                        title="next chapter">Plugin Framework</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plugins.html" title="Plugin Framework"
             >next</a> |</li>
        <li class="right" >
          <a href="jshooks.html" title="JS Hooks"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Thug 0.9.19 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011-2018, Angelo Dell&#39;Aera.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>